<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Table Builder</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: #1e1e1e;
      color: #f5f5f5;
    }
    nav {
      background: #111;
      padding: 1rem;
      display: flex;
      justify-content: space-around;
      border-bottom: 2px solid #333;
    }
    nav a {
      color: #f5f5f5;
      text-decoration: none;
      font-weight: bold;
    }
    nav a:hover {
      color: #00aaff;
    }
    .builder-container {
      display: flex;
      gap: 2rem;
      padding: 2rem;
    }
    canvas {
      background: #444;
      border-radius: 12px;
      flex: 2;
    }
    .controls {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background: #2a2a2a;
      padding: 1rem;
      border-radius: 12px;
    }
    label {
      font-size: 0.9rem;
      font-weight: bold;
    }
    select, input[type=range] {
      width: 100%;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="builder.html">Builder</a>
    <a href="gallery.html">Gallery</a>
    <a href="contact.html">Contact</a>
  </nav>

  <div class="builder-container">
    <canvas id="tableCanvas" width="600" height="400"></canvas>
    <div class="controls">
      <label for="shapeSelect">Table Shape</label>
      <select id="shapeSelect">
        <option value="rectangle">Rectangle</option>
        <option value="square">Square</option>
        <option value="circle">Circle</option>
      </select>

      <label for="woodSelect">Wood Type</label>
      <select id="woodSelect">
        <option value="oak">Oak</option>
        <option value="walnut">Walnut</option>
        <option value="cherry">Cherry</option>
        <option value="maple">Maple</option>
      </select>

      <label for="epoxyColor">Epoxy Color</label>
      <input type="color" id="epoxyColor" value="#00aaff"/>

      <label for="epoxyOpacity">Epoxy Opacity</label>
      <input type="range" id="epoxyOpacity" min="0" max="1" step="0.05" value="0.6"/>

      <label for="riverWidth">River Width</label>
      <input type="range" id="riverWidth" min="20" max="150" step="5" value="80"/>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("tableCanvas");
    const ctx = canvas.getContext("2d");

    const shapeSelect = document.getElementById("shapeSelect");
    const woodSelect = document.getElementById("woodSelect");
    const epoxyColor = document.getElementById("epoxyColor");
    const epoxyOpacity = document.getElementById("epoxyOpacity");
    const riverWidth = document.getElementById("riverWidth");

    // preload wood textures
    const woodTextures = {
      oak: "images/wood/oak.jpg",
      walnut: "images/wood/walnut.jpg",
      cherry: "images/wood/cherry.jpg",
      maple: "images/wood/maple.jpg",
    };
    const textureImgs = {};
    for (let key in woodTextures) {
      const img = new Image();
      img.src = woodTextures[key];
      textureImgs[key] = img;
    }

    function drawTable() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const shape = shapeSelect.value;
      const wood = woodSelect.value;
      const color = epoxyColor.value;
      const opacity = parseFloat(epoxyOpacity.value);
      const width = parseInt(riverWidth.value);

      ctx.save();

      // Draw wood shape with texture
      const woodImg = textureImgs[wood];
      if (woodImg.complete) {
        const pattern = ctx.createPattern(woodImg, "repeat");
        ctx.fillStyle = pattern;
      } else {
        ctx.fillStyle = "#663300";
      }

      ctx.beginPath();
      if (shape === "rectangle") {
        ctx.rect(50, 50, 500, 300);
      } else if (shape === "square") {
        ctx.rect(150, 50, 300, 300);
      } else if (shape === "circle") {
        ctx.arc(300, 200, 150, 0, Math.PI * 2);
      }
      ctx.closePath();
      ctx.fill();
      ctx.clip();

      // Draw epoxy river overlay
      ctx.globalAlpha = opacity;
      ctx.fillStyle = color;
      ctx.beginPath();

      if (shape === "rectangle") {
        generateRiverPath(50, 200, 500, width); // centered vertically
      } else if (shape === "square") {
        generateRiverPath(150, 200, 300, width); // centered vertically
      } else if (shape === "circle") {
        generateCurvedRiverPath(300, 200, 150, width);
      }

      ctx.fill();
      ctx.globalAlpha = 1;
      ctx.restore();
    }

    function generateRiverPath(x, y, width, riverW) {
      ctx.moveTo(x, y - riverW / 2);
      const step = 50;
      for (let i = 0; i <= width; i += step) {
        const offset = Math.sin(i / 50) * 30;
        ctx.lineTo(x + i, y - riverW / 2 + offset);
      }
      for (let i = width; i >= 0; i -= step) {
        const offset = Math.sin(i / 50) * 30;
        ctx.lineTo(x + i, y + riverW / 2 + offset);
      }
      ctx.closePath();
    }

    function generateCurvedRiverPath(cx, cy, radius, riverW) {
      const step = Math.PI / 30; // curve detail
      ctx.moveTo(cx - radius, cy - riverW / 2);

      for (let angle = Math.PI; angle >= 0; angle -= step) {
        const offset = Math.sin(angle * 3) * 20;
        ctx.lineTo(cx + Math.cos(angle) * radius,
                   cy + Math.sin(angle) * radius - riverW / 2 + offset);
      }
      for (let angle = 0; angle <= Math.PI; angle += step) {
        const offset = Math.sin(angle * 3) * 20;
        ctx.lineTo(cx + Math.cos(angle) * radius,
                   cy + Math.sin(angle) * radius + riverW / 2 + offset);
      }
      ctx.closePath();
    }

    shapeSelect.addEventListener("change", drawTable);
    woodSelect.addEventListener("change", drawTable);
    epoxyColor.addEventListener("input", drawTable);
    epoxyOpacity.addEventListener("input", drawTable);
    riverWidth.addEventListener("input", drawTable);

    window.onload = () => {
      drawTable();
    };
  </script>
</body>
</html>
